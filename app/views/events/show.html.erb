

<h1><%= @event.name %></h1>
<h3><%= @event.formatted_date %> - <%= link_to 'Edit', edit_event_path(@event) %></h3>

<button id="js-new-gift-button">Create Gift</button><br>

<div id="break_div"></div>
<div id="error_div"></div>
<div id="js-gift-form-div"></div>

<div id="giftList">
  <ul>
    <% @event.gifts.sort_by(&:name).each do |gift| %>
      <li>
        <div id="error_div_<%= gift.id %>"></div>
        <div id="break_div_<%= gift.id %>"></div>
        <div class="gift-div" id="gift-element-<%= gift.id %>" data-id="<%= gift.id %>">
          <%= gift.name %> - <a href="#" class="editLink" data-id="<%= gift.id %>">Edit</a> <a href="#" class="removeLink" data-id="<%= gift.id %>">Remove</a>
          <% gift.givers.each do |giver| %>
            <ul>
              <li><%= link_to giver.name, giver_path(giver) %></li>
            </ul>
          <% end %>
        </div>
      </li>
    <% end %>
  </ul>
</div>


<script type="text/javascript" charset="utf-8">
  $('#js-new-gift-button').on("click", function(event) {
    event.preventDefault()
    $('#break_div').html('<br>')
    $('#js-gift-form-div').load('/events/<%= @event.id %>/gifts/new')
  })
</script>

<script>
  $(function () {
    $('#js-gift-form-div').submit(function(event) {
      event.preventDefault();

      var values = $("#new_gift", this).serialize();

      var posting = $.post(`/events/<%= @event.id %>/gifts`, values);

      posting.done(function(data) {

        if (typeof data === "string") {
          $('#error_div').html($(data).filter('#error_explanation'))
          $('#js-gift-form-div').load('/events/<%= @event.id %>/gifts/new')
        }
        if (typeof data === "object") {
          $('#error_div').html("")
          $.get('/events/<%= @event.id %>', function(data) {
            $('#break_div').html("")
            $('#giftList').html($(data).filter('#giftList'))
            $('#js-gift-form-div').html($(data).filter('#js-gift-form-div'))
          })
        }
        $("js-gift-form-div").html("")
      })
    });
  });
</script>

<script>
  $(function () {
    $('.editLink').on("click", function(event) {
      event.preventDefault();
      var id = $(this).data("id");
      $('#gift-element-' + id).load('/events/<%= @event.id %>/gifts/' + id + '/edit')
    })
  })
</script>

<script>
  $(function () {
    $('.removeLink').on("click", function(event) {
      event.preventDefault()
      var id = $(this).data("id")
      $.ajax({
        url: "/events/<%= @event.id %>/gifts/" + id,
        method: "DELETE",
        data: id
      }).done(function() {
        $.get('/events/<%= @event.id %>', function(data) {
          $('#giftList').html($(data).filter('#giftList'))
        })
      })
    })
  })
</script>

<%-#link_to 'Remove', "#", data: {confirm: 'Are you sure?'}, method: :delete %>
